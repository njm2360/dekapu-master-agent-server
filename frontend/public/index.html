<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <title>グループインスタンス管理</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" href="/favicon.png" type="image/png">
</head>

<body>
  <div class="container my-4">
    <h1 class="mb-4">グループインスタンス管理</h1>

    <!-- グループ選択 -->
    <div class="card mb-4">
      <div class="card-body">
        <h5 class="card-title">グループ選択</h5>
        <select id="groupSelect" class="form-select"></select>
      </div>
    </div>

    <!-- インスタンス一覧 -->
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">インスタンス一覧</h5>
        <div class="table-responsive">
          <table class="table table-striped table-bordered align-middle mb-0">
            <thead class="table-light">
              <tr>
                <th>表示名</th>
                <th>ユーザー数</th>
                <th> クローズ日時</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody id="instanceTableBody">
              <tr>
                <td colspan="4" class="text-center text-muted">
                  グループを選択してください
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="mt-2 d-flex justify-content-end align-items-center gap-2 text-muted small">
          <span>最終更新日時</span>
          <span id="lastUpdated" style="width: 180px; text-align: right;">
            未取得
          </span>
        </div>
      </div>
    </div>

    <!-- ボタン -->
    <div class="mt-4 d-flex justify-content-end gap-2">
      <button id="refreshBtn" class="btn btn-outline-secondary">
        一覧更新
      </button>
      <button id="openCreateModalBtn" class="btn btn-primary">
        インスタンス作成
      </button>
    </div>

    <!-- インスタンス作成モーダル -->
    <div class="modal fade" data-bs-backdrop="static" data-bs-keyboard="false" id="createInstanceModal" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">インスタンス作成</h5>
          </div>

          <div class="modal-body">
            <div class="mb-3">
              <label class="form-label">インスタンス名</label>
              <!-- 指定しない -->
              <div class="form-check">
                <input class="form-check-input" id="instanceNameNotSpecified" type="radio" name="instanceMode"
                  value="none" checked>
                <label class="form-check-label" for="instanceNameNotSpecified">指定しない</label>
              </div>

              <!-- 選択 -->
              <div class="form-check d-flex align-items-center gap-2 mt-2">
                <input class="form-check-input" id="instanceNameSelect" type="radio" name="instanceMode" value="select">
                <label class="form-check-label" for="instanceNameSelect">選択</label>
                <select id="selectInput" class="form-select form-select-sm w-50" disabled>
                  <option value="リンゴ支部">リンゴ支部</option>
                  <option value="イチゴ支部">イチゴ支部</option>
                  <option value="メロン支部">メロン支部</option>
                  <option value="スイカ支部">スイカ支部</option>
                  <option value="バナナ支部">バナナ支部</option>
                  <option value="ブドウ支部">ブドウ支部</option>
                  <option value="マンゴー支部">マンゴー支部</option>
                  <option value="レモン支部">レモン支部</option>
                  <option value="ゆるぶっぱ">ゆるぶっぱ</option>
                  <option value="スキルブッパ会">スキルブッパ会</option>
                </select>
              </div>

              <!-- 手動 -->
              <div class="form-check d-flex align-items-center gap-2 mt-2">
                <input class="form-check-input" id="instanceNameManual" type="radio" name="instanceMode" value="manual">
                <label class="form-check-label" for="instanceNameManual">手動</label>
                <input type="text" id="manualInput" class="form-control form-control-sm w-25" disabled>
              </div>
            </div>

            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="queueEnabled" checked>
              <label class="form-check-label" for="queueEnabled">待機列</label>
            </div>

            <div class="mb-3">
              <label for="regionSelect" class="form-label">Region</label>
              <select id="regionSelect" class="form-select">
                <option value="jp" selected>JP</option>
                <option value="use">USE</option>
                <option value="us">USW</option>
                <option value="eu">EU</option>
              </select>
            </div>

            <div class="mb-3">
              <label for="groupAccessTypeSelect" class="form-label">Access Type</label>
              <select id="groupAccessTypeSelect" class="form-select">
                <option value="public">Group Public</option>
                <option value="plus">Group+</option>
                <option value="members" selected>Group</option>
              </select>
            </div>

          </div>

          <div class="modal-footer">
            <button class="btn btn-secondary" data-bs-dismiss="modal">キャンセル</button>
            <button id="createInstanceBtn" class="btn btn-primary">作成</button>
          </div>
        </div>
      </div>
    </div>

    <!-- インスタンス作成完了モーダル -->
    <div class="modal fade" data-bs-backdrop="static" data-bs-keyboard="false" id="createCompleteModal" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">

          <div class="modal-header">
            <h5 class="modal-title">インスタンス作成完了</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>

          <div class="modal-body">
            インスタンスの作成が完了しました。
          </div>

          <div class="modal-footer">
            <button id="copyInstanceLinkBtn" class="btn btn-outline-secondary">
              リンクをコピー
            </button>
            <button id="startInstanceBtn" class="btn btn-primary">
              起動
            </button>
          </div>

        </div>
      </div>
    </div>

    <!-- コピートースト -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
      <div id="copySuccessToast" class="toast text-bg-success border-0" role="alert">
        <div class="d-flex">
          <div class="toast-body">
            リンクをコピーしました
          </div>
          <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>
      </div>
    </div>

    <!-- 起動モーダル -->
    <div class="modal fade" data-bs-backdrop="static" data-bs-keyboard="false" id="launchOptionsModal" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">起動設定</h5>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label class="form-label">起動マシン</label>
              <select id="clientSelect" class="form-select"></select>
            </div>

            <div class="accordion" id="launchOptionAccordion">
              <div class="accordion-item">
                <h2 class="accordion-header">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                    data-bs-target="#launchBasic">
                    Advanced Settings
                  </button>
                </h2>
                <div id="launchBasic" class="accordion-collapse collapse">
                  <div class="accordion-body">

                    <!-- Profile -->
                    <div class="row mb-2 align-items-center">
                      <label class="col-4 col-form-label">Profile</label>
                      <div class="col-8">
                        <input id="optProfile" type="number" class="form-control" value="0">
                      </div>
                    </div>

                    <!-- No VR -->
                    <div class="row mb-2 align-items-center">
                      <label class="col-4 col-form-label">No VR</label>
                      <div class="col-8">
                        <div class="form-check">
                          <input id="optNoVr" class="form-check-input" type="checkbox" checked>
                        </div>
                      </div>
                    </div>

                    <!-- FPS -->
                    <div class="row mb-2 align-items-center">
                      <label class="col-4 col-form-label">FPS</label>
                      <div class="col-8 d-flex align-items-center gap-2">
                        <input id="optFpsEnabled" class="form-check-input" type="checkbox">
                        <input id="optFps" type="number" class="form-control" value="60" min="1" disabled
                          style="max-width: 5em;">
                      </div>
                    </div>

                    <!-- MIDI -->
                    <div class="row mb-2 align-items-center">
                      <label class="col-4 col-form-label">MIDI</label>
                      <div class="col-8">
                        <input id="optMidi" type="text" class="form-control">
                      </div>
                    </div>

                    <!-- OSC -->
                    <div class="row mb-2 align-items-start">
                      <label class="col-4 col-form-label">OSC</label>
                      <div class="col-8">
                        <div class="form-check mb-2">
                          <input id="optOscEnabled" class="form-check-input" type="checkbox">
                        </div>
                        <div id="oscOptionBody" class="d-flex flex-column gap-2">
                          <input id="optOscInPort" type="number" class="form-control" placeholder="In Port" disabled
                            value="9000">
                          <input id="optOscOutIp" type="text" class="form-control" placeholder="Out IP" disabled
                            value="127.0.0.1">
                          <input id="optOscOutPort" type="number" class="form-control" placeholder="Out Port" disabled
                            value="9001">
                        </div>
                      </div>
                    </div>

                    <!-- CPU Affinity -->
                    <div class="row mb-2 align-items-center">
                      <label class="col-4 col-form-label">CPU Affinity</label>
                      <div class="col-8">
                        <input id="optAffinity" type="text" class="form-control">
                      </div>
                    </div>

                    <!-- Process Priority -->
                    <div class="row mb-2 align-items-center">
                      <label class="col-4 col-form-label">Process Priority</label>
                      <div class="col-8">
                        <select id="optProcessPriority" class="form-select">
                          <option value="-2">Idle</option>
                          <option value="-1">Below Normal</option>
                          <option value="0" selected>Normal</option>
                          <option value="1">Above Normal</option>
                          <option value="2">Highest</option>
                        </select>
                      </div>
                    </div>

                    <!-- Main Thread Priority -->
                    <div class="row mb-2 align-items-center">
                      <label class="col-4 col-form-label">Main Thread Priority</label>
                      <div class="col-8">
                        <select id="optMainThreadPriority" class="form-select">
                          <option value="-2">Lowest</option>
                          <option value="-1">Below Normal</option>
                          <option value="0" selected>Normal</option>
                          <option value="1">Above Normal</option>
                          <option value="2">Highest</option>
                        </select>
                      </div>
                    </div>

                    <div class="form-check">
                      <input id="optWatchWorlds" class="form-check-input" type="checkbox">
                      <label class="form-check-label" for="optWatchWorlds">Watch Worlds</label>
                    </div>

                    <div class="form-check">
                      <input id="optWatchAvatars" class="form-check-input" type="checkbox">
                      <label class="form-check-label" for="optWatchAvatars">Watch Avatars</label>
                    </div>

                    <div class="form-check">
                      <input id="optDebugGui" class="form-check-input" type="checkbox">
                      <label class="form-check-label" for="optDebugGui">Debug GUI</label>
                    </div>

                    <div class="form-check">
                      <input id="optSdkLogLevels" class="form-check-input" type="checkbox">
                      <label class="form-check-label" for="optSdkLogLevels">SDK Log Levels</label>
                    </div>

                    <div class="form-check">
                      <input id="optUdonDebugLogging" class="form-check-input" type="checkbox">
                      <label class="form-check-label" for="optUdonDebugLogging">Udon Debug Logging</label>
                    </div>

                    <div class="mb-2">
                      <label class="form-label">Extra args</label>
                      <input id="optExtraArgs" type="text" class="form-control">
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="modal-footer">
            <button class="btn btn-secondary" data-bs-dismiss="modal">キャンセル</button>
            <button id="launchBtn" class="btn btn-primary">OK</button>
          </div>
        </div>
      </div>
    </div>

    <!-- クローズ確認モーダル -->
    <div class="modal fade" data-bs-backdrop="static" data-bs-keyboard="false" id="closeConfirmModal" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">
              インスタンス「<span id="closeInstanceName"></span>」をクローズしますか？
            </h5>
          </div>
          <div class="modal-footer">
            <button class="btn btn-secondary" data-bs-dismiss="modal">キャンセル</button>
            <button id="confirmCloseBtn" class="btn btn-danger">クローズ</button>
          </div>
        </div>
      </div>
    </div>

    <!-- 起動成功トースト -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
      <div id="launchSuccessToast" class="toast align-items-center text-bg-success border-0" role="alert"
        aria-live="assertive" aria-atomic="true">
        <div class="d-flex">
          <div class="toast-body">
            インスタンスを起動しました
          </div>
          <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
    crossorigin="anonymous"></script>
  <script src="app.js"></script>
</body>

</html>
